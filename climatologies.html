<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title></title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.1/css/spacelab.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/respond.min.js"></script>
<style type="text/css">
/* padding for bootstrap navbar */
body {
padding-top: 50px;
padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar) */
.section h2 {
padding-top: 55px;
margin-top: -55px;
}
.section h3 {
padding-top: 55px;
margin-top: -55px;
}
/* don't use link color in navbar */
.dropdown-menu>li>a {
color: black;
}
/* some padding for disqus */
#disqus_thread {
margin-top: 45px;
}
</style>
<link rel="stylesheet" href="libs/font-awesome-4.1.0/css/font-awesome.min.css"/>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #303030; color: #cccccc; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; }
td.sourceCode { padding-left: 5px; }
pre, code { color: #cccccc; background-color: #303030; }
code > span.kw { color: #f0dfaf; }
code > span.dt { color: #dfdfbf; }
code > span.dv { color: #dcdccc; }
code > span.bn { color: #dca3a3; }
code > span.fl { color: #c0bed1; }
code > span.ch { color: #dca3a3; }
code > span.st { color: #cc9393; }
code > span.co { color: #7f9f7f; }
code > span.ot { color: #efef8f; }
code > span.al { color: #ffcfaf; }
code > span.fu { color: #efef8f; }
code > span.er { color: #c3bf9f; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46129458-3', 'auto');
  ga('send', 'pageview');

</script>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">

<div class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Downscaling</a>
      </div>
      <div class="navbar-collapse collapse navbar-responsive-collapse">
        <ul class="nav navbar-nav">
          <li><a href="index.html">Overview</a></li>

          <li class="dropdown">
            <a href="climatologies" class="dropdown-toggle" data-toggle="dropdown">Climatologies <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">Main script</li>
              <li><a href="climatologies.R">climatologies.R</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Functions</li>
              <li><a href="climPrep.R">climPrep.R</a></li>
              <li><a href="climCalc.R">climCalc.R</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">CRU 2.0</li>
              <li><a href="cru20prelimExtraction">cru20prelimExtraction</a></li>
            </ul>

          <li class="dropdown">
            <a href="anomalies" class="dropdown-toggle" data-toggle="dropdown">Anomalies <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">Main script</li>
              <li><a href="anomalies.R">anomalies.R</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Functions</li>
              <li><a href="anomPrep.R">anomPrep.R</a></li>
              <li><a href="anomCalc.R">anomCalc.R</a></li>
              <li><a href="anomCalcAsScript.R">anomCalcAsScript.R</a></li>
              <li><a href="anomParSubFunc.R">anomParSubFunc.R</a></li>
            </ul>

          <li class="dropdown">
            <a href="downscaling" class="dropdown-toggle" data-toggle="dropdown">Downscaling <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">10-minute CRU 2.0</li>
              <li><a href="ds_world10min.R">ds_world10min.R</a></li>
            </ul>

          <li><a href="http://leonawicz.github.io">All Projects</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <a class="btn btn-link" href="https://github.com/leonawicz/Downscaling">
            <i class="fa fa-github fa-lg"></i>
            Github
          </a>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </div>



<div id="section" class="section level2">
<h2></h2>
</div>
<div id="section-1" class="section level2">
<h2></h2>
</div>
<div id="climatologies.r" class="section level2">
<h2>climatologies.R</h2>
<p>This script generates monthly climatologies geotiffs. <code>climatologies.R</code> uses the original annual geotiffs to produce climatologies for each month. An arbitrary climatology period may be specified. Common periods include 1961-1990, 1971-2000, and 1958-2001. Periods are chosen based on the climatology period of an alternate higher-resolution data set to which the data here will eventually be downscaled. Climatology geotiffs are created for the climate variables temperature and precipitation, and in some cases sea level pressure. Each mutli-band geotiff contains twelve monthly bands.</p>
<p><code>climatologies.R</code> is the first preparatory script run as part of the overall downscaling process chain, although climatologies are often used for other unrelated projects as well.</p>
<div id="r-code" class="section level3">
<h3>R code</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(raster)
<span class="kw">library</span>(parallel)

<span class="co"># Source functions</span>
path.fun &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="st">&quot;/workspace/UA/mfleonawicz/leonawicz/projects/Downscaling/code&quot;</span>)
<span class="kw">source</span>(<span class="kw">file.path</span>(path.fun, <span class="st">&quot;climPrep.R&quot;</span>))
<span class="kw">source</span>(<span class="kw">file.path</span>(path.fun, <span class="st">&quot;climCalc.R&quot;</span>))

#### Choose datasets (current options: &#39;cru30&#39; &#39;cru31&#39; &#39;cru3101&#39; &#39;cru322&#39;
#### &#39;ERA40&#39; &#39;AR4gcm&#39; &#39;AR5gcm&#39;) #### Note cru3101 will still place
#### precipitation outputs into in a &#39;CRU31&#39; folder.
dataset &lt;-<span class="st"> &quot;cru322&quot;</span>

#### Set year ranges for reference climatology period ####
yrs.clim &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1961</span>, <span class="dv">1990</span>)

#### Top level climatology directory ####
<span class="kw">dir.create</span>(newDir &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="st">&quot;/Data/Base_Data/Climate/World/Climatologies&quot;</span>), 
    <span class="dt">showWarnings =</span> F)

#### Set to TRUE is resampling outputs to a new grid and specify any raster
#### layer as the new grid ####
resample &lt;-<span class="st"> </span>F
if (resample) r &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="kw">file.path</span>(drive[<span class="dv">3</span>], <span class="st">&quot;/Base_Data/Climate/World/ERA40/ERA40_historical_monthly_195709-200208.nc&quot;</span>), 
    <span class="dt">varname =</span> <span class="st">&quot;t2m&quot;</span>, <span class="dt">layer =</span> <span class="dv">1</span>)

dp &lt;-<span class="st"> </span><span class="kw">climPrep</span>(dataset, yrs.clim, <span class="dt">include.psl =</span> F)  <span class="co"># add include.psl=T if psl is to be included. Only available for ERA40 and historical GCMs.</span>
for (i in <span class="dv">1</span>:<span class="kw">length</span>(dp)) <span class="kw">assign</span>(<span class="kw">names</span>(dp)[i], dp[[i]])
for (k in <span class="dv">1</span>:<span class="kw">length</span>(mainDir)) <span class="kw">mclapply</span>(<span class="dv">1</span>:<span class="kw">length</span>(files[[k]]), climCalc, <span class="dt">yr1 =</span> yrs.clim[<span class="dv">1</span>], 
    <span class="dt">yr2 =</span> yrs.clim[<span class="dv">2</span>], <span class="dt">var =</span> varid[k], <span class="dt">scen =</span> scen[k], <span class="dt">datID =</span> datID, <span class="dt">arID =</span> arID, 
    <span class="dt">pq =</span> <span class="kw">c</span>(<span class="fl">0.01</span>, <span class="fl">0.99</span>), <span class="dt">tq =</span> <span class="kw">c</span>(<span class="fl">0.01</span>, <span class="fl">0.99</span>), <span class="dt">setNAs =</span> <span class="fl">0.5</span>, <span class="dt">interpNAs =</span> T, <span class="dt">mc.cores =</span> <span class="kw">length</span>(files[[k]]))</code></pre>
</div>
</div>

<!-- some extra javascript for older browsers -->
<script type="text/javascript" src="libs/polyfill.js"></script>
<script>
  // manage active state of menu based on current page
  $(document).ready(function () {
  
    // active menu
    href = window.location.pathname
    href = href.substr(href.lastIndexOf('/') + 1)
    $('a[href="' + href + '"]').parent().addClass('active');
    
    // manage active menu header
    if (href.startsWith('authoring_'))
      $('a[href="' + 'authoring' + '"]').parent().addClass('active');
    else if (href.endsWith('_format.html'))
      $('a[href="' + 'formats' + '"]').parent().addClass('active');
    else if (href.startsWith('developer_'))
      $('a[href="' + 'developer' + '"]').parent().addClass('active');
	  
  });
</script>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>


</body>
</html>
